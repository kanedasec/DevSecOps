
name: Secrets Scan
on:
  workflow_call:

jobs:
  static_analysis:
      name: Secrets Scan
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v3

        - name: 🔐 GitLeaks Secrets Scan (Full History)
          run: |
            curl -sSL https://github.com/gitleaks/gitleaks/releases/download/v8.24.3/gitleaks_8.24.3_linux_x64.tar.gz -o gitleaks.tar.gz
            mkdir gitleaks-bin && tar -xzf gitleaks.tar.gz -C gitleaks-bin
            ./gitleaks-bin/gitleaks detect \
              --no-git \
              --report-format=json \
              --report-path=gitleaks.json \
              --redact \
              --exit-code=0
            ls -la

        - name: 📦 Upload GitLeaks Report
          uses: actions/upload-artifact@v4
          with:
            name: gitleaks-report
            path: gitleaks.json